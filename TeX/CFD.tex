\documentclass[10pt, titlepage]{article}
\usepackage[english]{babel}
\usepackage{amsmath}
\usepackage{color}
\usepackage{amsfonts}
\usepackage{xcolor,graphicx}
\usepackage{geometry}
\usepackage{animate}
\usepackage{listings}
\usepackage{wrapfig}
\usepackage{subcaption}
\usepackage{hyperref}

\usepackage{lipsum}

%Modified from:
%http://mathematica.stackexchange.com/a/83811

\definecolor{listinggray}{gray}{0.9}
\definecolor{graphgray}{gray}{0.7}
\definecolor{blue}{rgb}{0,0,1}
\definecolor{mygreen}{rgb}{0,0.6,0}
\definecolor{mygray}{rgb}{0.5,0.5,0.5}
\definecolor{purple}{rgb}{0.5,0,0.5}
\definecolor{orange}{rgb}{1,0.5,0}

% define a custom mathematica language for syntax highlighting
\lstdefinelanguage{myMMA}{
basicstyle=\ttfamily,
keywords={SetDirectory, ColorData, BarLegend, LegendLabel, Graphics, Gray, Polygon, Import, Do, If, Dimensions, Break, AppendTo, Sqrt, All, Length, ListDensityPlot, ColorFunction, PlotRange, AspectRatio, PlotLegends, ColorFunctionScaling, FrameLabel, PlotLabel, Style, FontSize, Black, ImageSize, Full, Show, Automatic, False, LegendMarkerSize, ToString, $CommandLine, Print, LabelStyle, ListContourPlot, ContourShading, Export, Contours, None, Frame, True},
keywords=[2]{i},
keywordstyle=\color{black},
keywordstyle=[2]\color{mygreen},
commentstyle=\color{gray}, 
stringstyle=\color{purple},
identifierstyle=\color{blue},
sensitive=false,
comment=[l]{(*},
morecomment=[s]{/*}{*/},
morecomment=[l][\color{orange}]{\#!},
morestring=[b]',
morestring=[b]",
breaklines=true,
captionpos=b,
numbers=left,
literate={->}{$\rightarrow{}$}{1}
}


\title{Computational Fluid Dynamics}
\author{Brady Metherall \and 100516905}
\date{Monday April 4, 2016}

\begin{document}
\newgeometry{margin=1in}
\maketitle
\setlength\parindent{0pt}
\lstset{language=myMMA}

\listoffigures

\section{Introduction}

\begin{wrapfigure}{R}{0.5\textwidth}
\centering
\includegraphics[width = 0.5\textwidth]{Pictures/aero}
\caption[Possibilities with CFD]{Possibilities with CFD \cite{aeroplane}}
\label{fig:aeroplane}
\end{wrapfigure}

CFD joins theory and experiment as third subfield \\
CFD is like a wind tunnel but cheaper and faster \\
reshaping \\
changing Re, Mach, P ... \\
portable / remote access \\

\lipsum[1-4]

\section{Theory}

\subsection{Non-Turbulent Flow Equations}
%\begin{align*}
%\frac{D\bf{u}}{Dt} &= \frac{\partial \bf{u}}{\partial t} + \left( \bf{u} \cdot \nabla \right) \bf{u}
%\end{align*}

Non-viscous, ideal fluids obey two equations of motion collectively called Euler's equations. The first is the incompressibility condition 
\begin{align}
\nabla \cdot \bf{u} &= 0
\label{eq:incomp}
\end{align}
which arises by assuming the volume of a fluid element, as well as it's density is constant. The second equation can be derived from Newton's second law, 
\begin{align}
\frac{\partial \bf{u}}{\partial t} + \left( \bf{u} \cdot \nabla \right) \bf{u} &= - \frac{1}{\rho} \nabla p + \bf{g}. \label{eq:euler}
\end{align}
The problem with Euler's equations is that they are only applicable for non-viscous fluids, which is not very practical. One of the subtler details is that the force experienced by a fluid element is always normal to it's surface. However, due to the fluid elements interacting, tangential forces arise. Cauchy's equation,
\begin{align}
\rho \left( \frac{\partial \bf{u}}{\partial t} + \left( \bf{u} \cdot \nabla \right) \bf{u} \right) &= \nabla \cdot \bf{T} + \rho \bf{g}
\label{eq:cauchy}
\end{align}
adds a stress tensor to handle theses additional forces. If we chose $\textbf{T}_{ij} = -p \delta_{ij}$ we simply get \eqref{eq:euler}, as expected, however, if we chose a more complex tensor with a deformation term, such as
\begin{align*}
\textbf{T}_{ij} = -p \delta_{ij} + \mu \left( \frac{\partial u_j}{\partial x_i} + \frac{\partial u_i}{\partial x_j} \right),
\end{align*}
\eqref{eq:cauchy} reduces to 
\begin{align}
\rho \left( \frac{\partial \bf{u}}{\partial t} + \left( \bf{u} \cdot \nabla \right) \bf{u} \right) &= - \nabla p + \mu \nabla^2 \bf{u} + \rho \bf{g} \quad \text{or,} \nonumber \\
\frac{\partial \bf{u}}{\partial t} + \left( \bf{u} \cdot \nabla \right) \bf{u} &= - \frac{1}{\rho} \nabla p + \nu \nabla^2 \bf{u} + \bf{g}, \label{eq:NSE}
\end{align}
which along with the incompressibility condition, \eqref{eq:incomp}, are the Navier-Stokes equations. Notice that if $\nu = 0$, there is no interaction between fluids elements, and this reduces simply to Euler's equations, \eqref{eq:euler}. 

\subsection{Reynolds-Averaged Navier-Stokes (RANS) Equation}
The Navier-Stokes equations are notoriously difficult to solve since it is a second order partial differential equation, with three components, and four dependencies each. To make solving the Navier-Stokes equations easier, especially for turbulent flows, we can assume the flow is the superposition of the steady, and turbulent flows, and then take the time average. We can make the following variable substitutions
\begin{align*}
\alpha_i &\equiv \overline{\alpha_i} + \alpha_i', \\
\text{where } \overline{\alpha_i} &= \frac{1}{\tau} \int_0^\tau \alpha_i dt
\end{align*}
is the steady time average on some time scale $\tau$, and $\alpha_i'$ is the turbulent perturbations. It follows from this definition that
\begin{align}
\overline{\alpha_i'} = 0, \quad \frac{\partial \overline{\alpha_i}}{\partial t} = 0, \quad \overline{\overline{\alpha_i}} = \overline{\alpha_i}, \quad \text{and} \quad \overline{\frac{\partial \alpha_i}{\partial x_i}} =  \frac{\partial \overline{\alpha_i}}{\partial x_i}. \label{eq:RANSprop}
\end{align}
We can write \eqref{eq:NSE} in the more suggestive component form:
\begin{align*}
\sum_j \frac{\partial u_i}{\partial t} + u_j \frac{\partial u_i}{\partial x_j} &= \sum_j  -\frac{1}{\rho} \frac{\partial p}{\partial x_i} + \nu \frac{\partial^2 u_i}{\partial x_j^2} + g_i,
\end{align*}
then, making the appropriate substitutions, taking the time average, and using the properties from  \eqref{eq:RANSprop}, we obtain
\begin{align*}
\sum_j \overline{u_j} \frac{\partial \overline{u_i}}{\partial x_j} + u_j' \frac{\partial u_i'}{\partial x_j} &= \sum_j  -\frac{1}{\rho} \frac{\partial \overline{p}}{\partial x_i} + \nu \frac{\partial^2 \overline{u_i}}{\partial x_j^2} + \overline{g_i}.
\end{align*}
Rewriting this in vector form gives the Reynolds-Averaged Navier-Stokes equation,
\begin{align}
\left( \bf{\overline{u}} \cdot \nabla \right) \bf{\overline{u}} + \left( \bf{u'} \cdot \nabla \right) \bf{u'}&= - \frac{1}{\rho} \nabla \overline{p} + \nu \nabla^2 \bf{\overline{u}} + \bf{\overline{g}}. \label{eq:RANS}
\end{align}

\subsection{Spalart-Allmaras (SA) Turbulent Model}\label{subsec:saturb}
While \eqref{eq:RANS} makes fluid flow predictions easier, a model is still needed for $\nu$. According to the Boussinesq hypothesis \cite{Boussinesq}, an increase in the viscosity gives the effect of turbulence, and therefore $\nu = \overline{\nu} + \nu'$. One such way to model this altered viscosity and the turbulence, is the Spalart-Allmaras turbulence model. This model determines the turbulent viscosity using the following:
\begin{align}
\nu' = \hat{\nu} f_{v1}; \qquad f_{v1} = \frac{\chi^3}{\chi^3+c_{v1}^3}; \qquad \chi \equiv \frac{\hat{\nu}}{\overline{\nu}}.
\label{eq:saeq}
\end{align}
Assuming the flow is incompressible, and the diffusivity is constant, $\hat{\nu}$ is obtained by solving the convection-diffusion equation,
\begin{align*}
\frac{\partial \hat{\nu}}{\partial t} = D \nabla^2 \hat{\nu} - \overline{\bf{u}} \nabla \hat{\nu},
\end{align*}
where $D$ is the diffusivity.

\section{Stanford University Unstructured ($SU^2$) Code}
$c_{v1} = 7.1$ for \eqref{eq:saeq} \\

Uses the SA turbulence model (\ref{subsec:saturb}) as well as the Menter Shear Stress Transport (SST) Model, however the SST model was not used in any of the simulations.

\lipsum[1-2]

\subsection{Mesh and Numerics}

\begin{wrapfigure}{R}{0.5\textwidth}
\centering
\includegraphics[width = 0.5\textwidth]{Pictures/AirfoilMesh}
\caption[Mesh of an Airfoil]{Mesh of an airfoil \cite{mesh}.}
\label{fig:airfoilmesh}
\end{wrapfigure}

Typically a particular node within the mesh will be surrounded by six triangular cells. Using the centroids of the cells, as well as the midpoints of the edges, we can construct a hexagonal region, $\Omega_i$. This leads to the discretized form of our PDE:
\begin{equation*}
\int_{\Omega_i} \frac{\partial \bf{u}}{\partial t} d\Omega + R_i(\textbf{u}) = 0
\end{equation*}
where $R_i(\bf{u})$ is the residual.

\section{Scripting and Automation}

Throughout this project Wolfram Mathematica 10.1.0 for Linux x86 was used to sift through the vast data files and extract the relevant information to produce the plots. The $SU^2$ code natively writes to the data files in the format used for Tecplot, a visualization and analysis tool for computational fluid dynamics \cite{tecplot}. Since Tecplot was not used, a Wolfram function was needed to convert the data to a form Mathematica could use. Once the data was in a usable form, the \texttt{ListDensityPlot} function was used to create the images. The function to tidy the data along with the plotting function were combined into a Wolfram script such as Figure \ref{fig:script}, which can be executed from the terminal. To fully automate the image generation, a shell script was written to iterate over each data file.

\begin{figure}[p]
\lstinputlisting[breaklines=true, label=makecontour]{MakeContour.m}
\caption[Automated Wolfram Script]{The Wolfram script used to generate Figure \ref{fig:airfoilanimation}. Syntax highlighting modified from \cite{syntax}.}
\label{fig:script}
\end{figure}

\section{Results}
\lipsum[1-2]

\subsection{Airfoil}
\lipsum[4-7]

\begin{figure}
\begin{subfigure}{0.5\linewidth}
\centering
\includegraphics[width=\textwidth]{./Pictures/Airfoil}
\caption{Airfoil no turbulence.}
\label{airfoil}
\end{subfigure}
\begin{subfigure}{0.5\textwidth}
\centering
\animategraphics[loop, width = \textwidth, autoplay]{12}{Airfoil_Animation_Turb/Airfoil_Turb}{0050}{0074}
\caption{Pitching airfoil, with velocity contours.}
\label{fig:airfoilanimation}
\end{subfigure}
\caption[Turbulent Airfoil Animation, and Laminar Airfoil Streamlines]{Airfoil things.}
\end{figure}

\subsection{Steady Flow Around a Static Cylinder}
\lipsum[1-2]

\begin{figure}[htbp]
\begin{subfigure}{0.5\linewidth}
  \centering
  \includegraphics[width=\textwidth]{./Pictures/Static_Cylinder}
  \caption{Euler}
  \label{fig:staticeuler}
\end{subfigure}
\begin{subfigure}{0.5\linewidth}
  \centering
  \includegraphics[width=\textwidth]{./Pictures/Static_Cylinder_NS}
  \caption{NS}
  \label{fig:staticNS}
\end{subfigure} \\
\begin{subfigure}{0.5\linewidth}
 \centering
 \includegraphics[width=\textwidth]{./Pictures/Static_Cylinder_Boundary}
 \caption{No-slip condition.}
 \label{fig:eulerboundary}
\end{subfigure}
\begin{subfigure}{0.5\linewidth}
 \centering
 \includegraphics[width=\textwidth]{./Pictures/Static_Cylinder_Boundary_NS}
 \caption{The boundary layer that forms due to a viscous fluid.}
 \label{fig:nsboundary}
\end{subfigure}
\caption[Static Cylinder]{Static Cylinders}
\label{fig:static}
\end{figure}

%\begin{figure}[htb]
%\centering
%\includegraphics[width=0.6\textwidth]{./Pictures/Static_Cylinder_NS_Boundary}
%\caption[Boundary Layer Due to Viscous Flow]{The boundary layer that forms due to a viscous fluid.}
%\label{fig:boundary}
%\end{figure}

\subsection{Turbulent Cylinder -- Vortex Shedding}

The equation \eqref{eq:euler} is interesting.

\begin{figure}[htb]
\centering
\animategraphics[label=vortex, loop, width = \textwidth, autoplay]{12}{Vortex_Animation/Vortex_Shedding}{00}{26}
\caption[Vortex Shedding Animation]{Neat! The full video can be found at \url{https://youtu.be/Zh5lWMpsCJg}}
\label{vortexanimation}
\end{figure}

\lipsum[1-2]

\begin{figure}
\begin{subfigure}{\linewidth}
  \centering
  \includegraphics[height=0.17\paperheight]{./Pictures/Vortex_Shedding1600}
  \caption{$t = 0$}
\end{subfigure} \\
\begin{subfigure}{\textwidth}
  \centering
  \includegraphics[height=0.17\paperheight]{./Pictures/Vortex_Shedding1628}
  \caption{$t = \frac{1}{4}T$}
\end{subfigure} \\
\begin{subfigure}{\linewidth}
  \centering
  \includegraphics[height=0.17\paperheight]{./Pictures/Vortex_Shedding1656}
  \caption{$t = \frac{1}{2}T$}
\end{subfigure} \\
\begin{subfigure}{\textwidth}
  \centering
  \includegraphics[height=0.17\paperheight]{./Pictures/Vortex_Shedding1684}
  \caption{$t = \frac{3}{4}T$}
\end{subfigure}
\caption[Vortex Shedding at $\frac{1}{4}T$ increments]{Vortex shedding!}
\label{fig:vortexshedding}
\end{figure}

\section{Conclusion}

\lipsum[5-7]

\newpage
\begin{thebibliography}{9}

\bibitem{su2main} %Main SU2 paper used for reference
Francisco Palacios, Juan Alonso, Karthikeyan Duraisamy, Michael Colonno, Jason Hicken, Aniket Aranake, Alejandro Campos, Sean Copeland, Thomas Economon, Amrita Lonkar, Trent Lukaczyk, and Thomas Taylor, \\
\emph{Stanford University Unstructured ($SU^2$): An open-source integrated computational environment for multi-physics simulation and design}, \\
51st AIAA Aerospace Sciences Meeting including the New Horizons Forum and Aerospace Exposition. 

\bibitem{Boussinesq} %Increased viscosity -> turbulence
D.C. Wilcox. \emph{Turbulence Modeling for CFD}. 2nd Ed., DCWIndustries, Inc., 1998.

\bibitem{syntax} %Mathematica syntax highlighting
Belisarius (http://mathematica.stackexchange.com/users/29581/belisarius), Highlighting Mathematica code in \LaTeX document, URL: http://mathematica.stackexchange.com/a/83811

\bibitem{mesh} %Image of mesh
https://github.com/su2code/SU2/wiki/Quick-Start

\bibitem{aeroplane} %Image of aeroplane CFD simulation
http://news.stanford.edu/news/2012/january/aero-engineering-software-012412.html

\bibitem{tecplot}
http://www.tecplot.com/

\end{thebibliography}

\end{document}